/*
  tcp_counters.bt
  - kprobe:tcp_sendmsg -> accumulate bytes (TX payload)
  - tracepoint:tcp:tcp_retransmit_skb -> count TCP retransmits
  - interval:s:5 -> print every 5s
*/
kprobe:tcp_sendmsg                { @bytes[0]   += arg2; }
tracepoint:tcp:tcp_retransmit_skb { @retrans[0] += 1; }
interval:s:5 {
  printf("MB=%llu, retrans=%llu\n", (@bytes[0]/1048576), @retrans[0]);
  clear(@bytes); clear(@retrans);
}